export LOCAL_IMAGE_NAME="stream-model-duration"

export PREDICTIONS_STREAM_NAME="ride_predictions"

aws --endpoint-url=http://localhost:4566 configure

aws --endpoint-url=http://localhost:4566 \
    kinesis create-stream \
    --stream-name ${PREDICTIONS_STREAM_NAME} \
    --shard-count 1

aws --endpoint-url=http://localhost:4566 \
    kinesis list-streams

aws --endpoint-url=http://localhost:4566 \
    kinesis describe-stream \
    --stream-name ${PREDICTIONS_STREAM_NAME}

aws --endpoint-url=http://localhost:4566 \
    kinesis put-record \
    --stream-name ${PREDICTIONS_STREAM_NAME} \
    --partition-key 1 \
    --data '{
        "ride": {
            "PULocationID": 130,
            "DOLocationID": 205,
            "trip_distance": 3.66
        }, 
        "ride_id": 156
    }'

SHARD='shardId-000000000000'

SHARD_ITERATOR=$(aws --endpoint-url=http://localhost:4566 \
    kinesis \
    get-shard-iterator \
        --shard-id ${SHARD} \
        --shard-iterator-type TRIM_HORIZON \
        --stream-name ${PREDICTIONS_STREAM_NAME} \
        --query 'ShardIterator' \
)

RESULT=$(aws --endpoint-url=http://localhost:4566 kinesis get-records --shard-iterator $SHARD_ITERATOR)

echo ${RESULT} | jq -r '.Records[0].Data' | base64 --decode
